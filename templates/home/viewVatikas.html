{% extends 'home/base_map.html'%}
{% load static %}
{% block extra_resources%}


<style>
  .popupimage {
    height: 200px;
    width: 300px;
    overflow: hidden;
    border-radius: 50px;
}
#map_canvas {
    height: 100%; 
    width: 100%; 
    position: absolute
}

</style>
{% endblock %}

{% block map %}


<!-- 
<div id="side-bar" style="background-color: rgba(0, 0, 0, 0.2);">
  <div id="navigatedarea">
    these two dropdowns are dependent
     <div class="tooltips" title="Please select Sector">
       <select class='form-control' id="sector" name="sector" >
           <option value="All">Select Sector</option>
           <optgroup label="Sector"> 
             <option value="education" onclick="education()">Education</option>

               <option value="healthcare" onclick="healthcare()">HealthCare</option>
               
   
         </select> 
        </div>
        
    &nbsp;&nbsp;
    <div class="tooltips">
      <select class='form-control' id="fy" name="fy">
        {% for entry in coalform %}
            <option value="{{ entry.fy }}" onclick="fy()">{{ entry.fy }}</option>
        {% endfor %}
        </select>
    </div>
  </div>
</div> -->
<div id="mapid" style="width: 100%; height: 100%;"></div>

  <!-- Modal Structure -->
  <div id="demo-modal" class="modal bottom-sheet"> 
    <div id="content" class="modal-content"> 
    </div> 
    <div class="modal-footer">
        <a href="#!" class="modal-close waves-effect waves-green btn-flat">Close</a>
      </div>
</div> 

<div id="demo-modal1" class="modal bottom-sheet"> 
  <div class="modal-header" style="text-align: right;">
    <a href="#!" class="modal-close waves-effect waves-green btn-flat" style="color: white; text-align: right; font-weight: bold; font-size: 20px;">X</a>
  </div>
  <div id="content1" class="modal-content"> 
  </div> 
  
</div> 
<div id="map_canvas"></div>
<!-- <input type ="button" onclick='window.open("{{ i.commpendium.url }}", "width=5,height=5,top=1,left=5", "_self")' value="Open Compendium"> -->

<!-- <script>
  var sectorlayerGroup = L.layerGroup();
  
</script>



{% for s in s1 %}
<script>
  function education(){
    `{% for s in s1 %}`
    var sector = document.getElementById('sector').value;
    console.log(sector);
    
    var marker = L.marker(["{{ s.lat }}", "{{ s.lng }}"], {icon:pvIcon1}).addTo(mymap); 
    // console.log(marker);
    sectorlayerGroup.addLayer(marker);
    // console.log(sectorlayerGroup);
    `{% endfor %}`
  }
</script>
{% endfor %}

<script>var sectorlayerGroup1 = L.layerGroup();</script>

<script>
  function healthcare(){
  
    `{% for s in s2 %}`
    var sector = document.getElementById('sector').value;
    console.log(sector);
    
    var marker = L.marker(["{{ s.lat }}", "{{ s.lng }}"], {icon:pvIcon1}).addTo(mymap); 
    // console.log(marker);
    sectorlayerGroup1.addLayer(marker);
    // console.log(sectorlayerGroup);
    `{% endfor %}`
  }
</script>

<script>var sectorlayerGroup2 = L.layerGroup();</script>

<script>
  function fy(){
    var fy = document.getElementById('fy').value;
    console.log(fy);
    

    `{% for i in coalform %}`
    // if `{{i.fy}}` is  fy:
    if (fy == "{{i.fy}}"){
      console.log("{{i.fy}}");
      var marker = L.marker(["{{ i.lat }}", "{{ i.lng }}"], {icon:pvIcon1}).addTo(mymap); 
      // console.log(marker);
      sectorlayerGroup2.addLayer(marker);
    // console.log(sectorlayerGroup);
    }
    `{% endfor %}`
  }
</script> -->


<script>
    let isClicked = false
    var mymap = L.map('mapid').setView([19.7515-1,75.7139-1], 4.5);
    
    var mbAttr = 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
			'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
		mbUrl = 'https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';

	//var grayscale   = L.tileLayer(mbUrl, {id: 'mapbox/light-v9', tileSize: 512, zoomOffset: -1, attribution: mbAttr}),
  //      streets  = L.tileLayer(mbUrl, {id: 'mapbox/streets-v11', tileSize: 512, zoomOffset: -1, attribution: mbAttr});
        
    // const url = 'https://geonode.communitygis.net/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&outputFormat=json&typename=geonode:diet_data8jan';
    const url = 'https://geoserver2.communitygis.net/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3Aposhan_dummy&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326&access_token=3r7XCeWunHUOfoyqPxnUNt7XY7ZWHu'
    const url1 = 'https://geoserver2.communitygis.net/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AOrganization_wise_Compendium&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326&access_token=3r7XCeWunHUOfoyqPxnUNt7XY7ZWHu'

    L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
			'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox/streets-v11',
		tileSize: 512,
		zoomOffset: -1
    }).addTo(mymap);
    
    console.log('l/tilelayer');
    var wms = L.tileLayer.wms('https://geoserver2.communitygis.net/geoserver/wms', {
				//layer: layer,
        layers: 'geonode:states_in_india',
				format: 'image/png',
				transparent: 'true',
			});
      wms.addTo(mymap);
      //console.log(layers);
      console.log(wms);

    // var baseLayers = {
		//"Grayscale": grayscale,
		//"Streets": streets
    //};
    var baseLayers = {};
    let indiaState = L.tileLayer.wms("https://geoserver2.communitygis.net/geoserver/wms", {
            layers: "geonode:states_in_india",
            format: "image/png",
            transparent: "true",
            tiled: "true",
            opacity: 0.7,
            }
        );
    let indiaDistrict = L.tileLayer.wms("https://geoserver2.communitygis.net/geoserver/wms", {
        layers: "geonode:all_india_districts_11june2020",
        format: "image/png",
        transparent: "true",
        tiled: "true",
        opacity: 0.7,
        }
    );

    let mahaHighways = L.tileLayer.wms("https://geoserver2.communitygis.net/geoserver/wms", {
        layers: "geonode:osm_highways",
        format: "image/png",
        transparent: "true",
        tiled: "true",
        opacity: 0.7,
        }
    );

    let mahaSchools = L.tileLayer.wms("https://geoserver2.communitygis.net/geoserver/wms", {
        layers: "geonode:school_16_17_11april",
        format: "image/png",
        transparent: "true",
        tiled: "true",
        opacity: 0.7,
        }
    );
</script>
	
   <style>
       .another-popup .leaflet-popup-content-wrapper .leaflet-popup-content{
          width: 200px;
          height:400px;
        }

  /* .another-popup .leaflet-popup-content-wrapper {
  background: beige;
  color: #eee;
  border-radius: 5%;
  border-radius: 0px;
} */
/* .another-popup .leaflet-popup-content-wrapper a {
  color: rgba(200, 200, 200, 0.1);
}
.another-popup .leaflet-popup-tip-container {
  width: 10px;
  height: 105px;

}
.another-popup .leaflet-popup-tip {
  background: beige;
  border: none;
  box-shadow: none;
} */
   </style>
         


<!-- coal -->

<script>
  
  var pvIcon = L.icon({
         iconUrl: "{% static 'map/images/Coal_India_Logo.png' %}",
         iconSize:     [40, 40], // size of the icon
         //shadowSize:   [50, 64], // size of the shadow
         iconAnchor:   [25,10], // point of the icon which will correspond to marker's location
         // shadowAnchor: [4, 62],  // the same for the shadow
         popupAnchor:  [0, 0] // point from which the popup should open relative to the iconAnchor
     });

   var coalGroup = L.layerGroup();
</script>
  
<!-- {% for i in coal %}

<script>
   //  alert("in vatikas -" +i+"- "+ +i.nutri_nm) 

 var table1 = 
      
      `<table class="w3-table" id="popup" style="font-size:12px; align:center;" >
        <tbody>
      
        {% if i.name %}
        <tr>
            <th><b>Project name</b></th>
            <th><b>{{ i.name}}</b></th>
        </tr>
        {% endif %}
        
        {% if i.implementing_agency %}
        <tr>
          <td>Implementing Agency</td>
          <td>{{ i.implementing_agency}}</td>
        </tr>
        {% endif %}

        {% if i.tot_project_outlay %}
        <tr>
          <td>Total Project Outlay</td>
          <td>{{ i.tot_project_outlay }}</td>
        </tr>
        {% endif %}
        
        {% if i.project_Status %}
        <tr>
          <td>Project Status</td>
          <td>{{ i.project_status }}</td>
        </tr>
        {% endif %}
        {% if i.picture %}
           <tr>
             <tr><img src={{ i.picture.url }} alt="No image uploaded" style="height:100px; width:170px; border:2px solid #555;"/>
           </tr>
        {% endif %}
 
        <tr>
          <td><a href="#"><img src="../static/map/images/icons8-pdf-40.png"/></a></td>
          {% if i.picture %}
            <td><a href="{{ i.picture.url }}" class="popupimage"><img src="../static/map/images/icons8-image-48.png"/></a></td>
          {% endif %}
          <td><a href="#"><img src="../static/map/images/icons8-microsoft-excel-48.png"/></a></td>
        </tr>  
      </tbody>
 </table> -->
 <!-- </br>` -->
    <!-- var popupOptions =
     {
       'maxWidth': '500',
       'className' : 'another-popup' // classname for another popup
     }
     var marker = L.marker(["{{ i.lat }}", "{{ i.lng }}"], {icon:pvIcon}).addTo(mymap).bindPopup(table1, popupOptions);
     coalGroup.addLayer(marker);
     // Added  hover to open popups
    //  marker.on('mouseover', function (e) {
    //        this.openPopup(e.latlng);
    //    });
    //  marker.on('mouseout', function (e) {
    //        this.openPopup(e.latlng);
    //  });
     marker.on('click', function (e) {
           this.openPopup(e.latlng);
     });

     mymap.on ({
         click: function() {
             isClicked = false
         },
         popupclose: function () {
             isClicked = false
         }
     })
 </script>
{% endfor %} -->





<!-- coal form -->

<script>
  
  var pvIcon1 = L.icon({
         iconUrl: "{% static 'map/images/coal_india_icon.png' %}",
         iconSize:     [40, 40], // size of the icon
         //shadowSize:   [50, 64], // size of the shadow
         iconAnchor:   [25,10], // point of the icon which will correspond to marker's location
         // shadowAnchor: [4, 62],  // the same for the shadow
         popupAnchor:  [0, 0] // point from which the popup should open relative to the iconAnchor
     });

   var coalGroup1 = L.layerGroup();
</script>
 
{% for i in coalform %}
<script>
   //  alert("in vatikas -" +i+"- "+ +i.nutri_nm) 

 var table4 = 
      
      `<table class="w3-table" id="popup" style="font-size:12px; align:center;" >
        <tbody>
      
        {% if i.project_name %}
        <tr>
            <th><b>Project name</b></th>
            <th><b>{{ i.project_name}}</b></th>
        </tr>
        {% endif %}
        
        {% if i.inputState %}
        <tr>
          <td>State</td>
          <td>{{ i.inputState}}</td>
        </tr>
        {% endif %}

        {% if i.inputDistrict %}
        <tr>
          <td>District</td>
          <td>{{ i.inputDistrict }}</td>
        </tr>
        {% endif %}
        {% if i.agencytype %}
        <tr>
          <td>Implementing Agency</td>
          <td>{{ i.agencytype}}</td>
        </tr>
        {% endif %}
        
        {% if i.Projectstatus %}
        <tr>
          <td>Project Status</td>
          <td>{{ i.Projectstatus }}</td>
        </tr>
        {% endif %}
        
        <tr>
          {% if i.commpendium %}
            <td><a href="{{ i.commpendium.url }}" target = "_app"><img src="../static/map/images/icons8-pdf-40.png"/></a></td>
            
             
          {% endif %}
          {% if i.picture %}
            <td><a href="{{ i.picture.url }}" class = "popupimage2" target = "_app"><img src="../static/map/images/icons8-image-48.png"/></a></td>
          {% else %}
            <td><img src="../static/map/images/icons8-image-48.png"/></td>
          
          
            {% endif %}  
          
            <td><a href="download/{{ i.id }}"><img src="../static/map/images/icons8-microsoft-excel-48.png" /></a></td>
             
          
          
          </tr>  
      </tbody>
 </table>

 
 </br>`
 var table5 = 
      
      `<table class="w3-table" id="table" style="font-size:12px; align:center;" >
        <tbody>
      
        {% if i.project_name %}
        <tr>
            <th><b>Project name</b></th>
            <th><b>{{ i.project_name}}</b></th>
        </tr>
        {% endif %}
        
        {% if i.sector %}
        <tr>
            <th><b>Sector</b></th>
            <th><b>{{ i.sector}}</b></th>
        </tr>
        {% endif %}
        {% if i.inputState %}
        <tr>
          <td>State</td>
          <td>{{ i.inputState}}</td>
        </tr>
        {% endif %}

        {% if i.inputDistrict %}
        <tr>
          <td>District</td>
          <td>{{ i.inputDistrict }}</td>
        </tr>
        {% endif %}
        {% if i.lat %}
        <tr>
          <td>Latitude</td>
          <td>{{ i.lat }}</td>
        </tr>
        {% endif %}
        {% if i.lng %}
        <tr>
          <td>Longitude</td>
          <td>{{ i.lng }}</td>
        </tr>
        {% endif %}
        fy
        {% if i.fy %}
        <tr>
          <td>FY</td>
          <td>{{ i.fy }}</td>
        </tr>
        {% endif %}
        {% if i.Projectstatus %}
        <tr>
          <td>Project Status</td>
          <td>{{ i.Projectstatus }}</td>
        </tr>
        {% endif %}
        {% if i.agencytype %}
        <tr>
          <td>Implementing Agency</td>
          <td>{{ i.agencytype}}</td>
        </tr>
        {% endif %}
        
        {% if i.organisation_name %}
        <tr>
          <td>Implementing Agency Name</td>
          <td>{{ i.organisation_name}}</td>
        </tr>
        {% endif %}
        {% if i.request_amount %}
        <tr>
          <td>Requested Amount</td>
          <td>{{ i.request_amount}}</td>
        </tr>
        {% endif %}
        {% if i.approved_amount %}
        <tr>
          <td>Approved Amount</td>
          <td>{{ i.approved_amount}}</td>
        </tr>
        {% endif %}
        
        <tr>
          {% if i.commpendium %}
          <td>Compendium</td>
            <td>{{ i.commpendium.url }}</td>
            
             
          {% endif %}
          {% if i.picture %}
            <td>Picture</td>
            <td>{{ i.picture.url }}</td>
          
            {% endif %}  
            <td><a href="#"><img src="../static/map/images/icons8-microsoft-excel-48.png" onclick="exportData()"/></a></td>
            
          </tr>  
      </tbody>
 </table>
 </br>
 
 `

//  console.log(table5);
    var popupOptions =
     {
       'maxWidth': '500',
       'className' : 'another-popup' // classname for another popup
     }

     
     var marker = L.marker(["{{ i.lat }}", "{{ i.lng }}"], {icon:pvIcon1}).addTo(mymap).bindPopup(table4, popupOptions);
     coalGroup1.addLayer(marker);
     // Added  hover to open popups
    //  marker.on('mouseover', function (e) {
    //        this.openPopup(e.latlng);
    //    });
    //  marker.on('mouseout', function (e) {
    //        this.openPopup(e.latlng);
    //  });
     marker.on('click', function (e) {
           this.openPopup(e.latlng);
     });

     mymap.on ({
         click: function() {
             isClicked = false
         },
         popupclose: function () {
             isClicked = false
         }
     })

     

 </script>
{% endfor %}
 


  <style>
  .another-popup .leaflet-popup-content-wrapper .leaflet-popup-content{
      width: 400px;
      height:auto;
    }

  </style>
  


<script>
  
  var overlays = {
        //"States":indiaState,
        "Districts":indiaDistrict,
        "Maharashtra Highways":mahaHighways,
        "Maharashtra Schools":mahaSchools,
        "Coal India Projects":coalGroup,
        "Coal Form":coalGroup1
	};

	L.control.layers(baseLayers, overlays).addTo(mymap);
  //L.control.layers(overlays).addTo(mymap);

document.addEventListener('DOMContentLoaded', () => {
    var elems = document.querySelectorAll('.modal');
    var instances = M.Modal.init(elems, {opacity:.3});
});

</script>


{% for i in coalform %}
<script src=”jquery.min.js” type=”text/javascript”></script>

    <script src=”table2excelmodified.js” type=”text/javascript”></script>
<script>
            
  // $(document).ready(function() {

  //     });

  
  function exportData(){
      /* Get the HTML data using Element by Id */
      var table = document.getElementById("popup");
      console.log(table);
//       table5 = 
      
//       `<table class="w3-table" id="table" style="font-size:12px; align:center;" >
//         <tbody>
      
//         {% if i.project_name %}
//         <tr>
//             <th><b>Project name</b></th>
//             <th><b>{{ i.project_name}}</b></th>
//         </tr>
//         {% endif %}
        
//         {% if i.sector %}
//         <tr>
//             <th><b>Sector</b></th>
//             <th><b>{{ i.sector}}</b></th>
//         </tr>
//         {% endif %}
//         {% if i.inputState %}
//         <tr>
//           <td>State</td>
//           <td>{{ i.inputState}}</td>
//         </tr>
//         {% endif %}

//         {% if i.inputDistrict %}
//         <tr>
//           <td>District</td>
//           <td>{{ i.inputDistrict }}</td>
//         </tr>
//         {% endif %}
//         {% if i.lat %}
//         <tr>
//           <td>Latitude</td>
//           <td>{{ i.lat }}</td>
//         </tr>
//         {% endif %}
//         {% if i.lng %}
//         <tr>
//           <td>Longitude</td>
//           <td>{{ i.lng }}</td>
//         </tr>
//         {% endif %}
        
//         {% if i.fy %}
//         <tr>
//           <td>FY</td>
//           <td>{{ i.fy }}</td>
//         </tr>
//         {% endif %}
//         {% if i.Projectstatus %}
//         <tr>
//           <td>Project Status</td>
//           <td>{{ i.Projectstatus }}</td>
//         </tr>
//         {% endif %}
//         {% if i.agencytype %}
//         <tr>
//           <td>Implementing Agency</td>
//           <td>{{ i.agencytype}}</td>
//         </tr>
//         {% endif %}
        
//         {% if i.organisation_name %}
//         <tr>
//           <td>Implementing Agency Name</td>
//           <td>{{ i.organisation_name}}</td>
//         </tr>
//         {% endif %}
//         {% if i.request_amount %}
//         <tr>
//           <td>Requested Amount</td>
//           <td>{{ i.request_amount}}</td>
//         </tr>
//         {% endif %}
//         {% if i.approved_amount %}
//         <tr>
//           <td>Approved Amount</td>
//           <td>{{ i.approved_amount}}</td>
//         </tr>
//         {% endif %}
        
        
//         {% if i.commpendium %}
//         <tr>
//           <td>Compendium</td>
//           <td>{{ i.commpendium.url }}</td>
//         </tr>    
             
//         {% endif %}
//         {% if i.picture %}
//         <tr>
//           <td>Picture</td>
//           <td>{{ i.picture.url }}</td>
//         </tr>  
//         {% endif %}  
            
          
//       </tbody>
//  </table>
//  </br>`    
      

//  $("#table").table2excel({
     
//                 filename: "Table.xls"
//             });
            // table5.table2excel({
            //   filename: "tab.xls"
            // });
//  var tab = document.getElementById("table");
//   console.log(tab);
//   //  var table = document.getElementById("table");
    //  console.log(table5);
      /* Declaring array variable */
      var rows =[];
  // var count = table5.rows.count;
  // console.log(count);
      //iterate through rows of table
      for(var i=0,row; row = table.rows[i];i++){
          //rows would be accessed using the "row" variable assigned in the for loop
          //Get each cell value/column from the row
          column1 = row.cells[0].innerText;
          
          // column1 = document.getElementById("comment[i]").value;
          // alert(column1);
          column2 = row.cells[1].innerText;
          // column3 = row.cells[2].innerText;
          // column4 = row.cells[3].innerText;
          // alert(column1);
          // column15 = row.cells[14].innerText;
          // column16 = row.cells[15].innerText;
          // column17 = row.cells[16].innerText;
      /* add a new records in the array */  
          // column11 = column11.replace(/,/g, '.') 

          rows.push(
              [
                  column1,
                  column2,
                  // column3,
                  // column4,
                  // column5,
                  // column6,
                  // column7,column8,column9,column10,column11,column12,column13,column14
                  // // column15,column16,column17
              ]
          );
  
      }
      csvContent = "data:text/csv;charset=utf-8,";
      /* add the column delimiter as comma(,) and each row splitted by new line character (\n) */
      rows.forEach(function(rowArray){
          row = rowArray.join(",");
          csvContent += row + "\r\n";
      });

      /* create a hidden <a> DOM node and set its download attribute */
      var encodedUri = encodeURI(csvContent);
      var link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "Download.csv");
      document.body.appendChild(link);
      /* download the data file named "Stock_Price_Report.csv" */
      link.click();
}

</script> 
{% endfor %}
{% endblock map%}